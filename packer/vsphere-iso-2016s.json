{
    "variables": {
        "name": "2016-packer",
        "guest_os_type": "windows9_64Guest",
        "answerfile": "answer_files/2016/Autounattend.xml"
    },
    "builders": [
        {
        "type": "vsphere-iso",
        "vm_name": "{{ user `name` }}",
        "iso_paths": [
            "[freenas_datastore_0] iso/en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso",
            "[freenas_datastore_0] iso/VMware-tools-windows-10.3.5-10430147.iso"
        ],
        "communicator": "winrm",
        "winrm_username": "vagrant",
        "winrm_password": "vagrant",
        "winrm_timeout": "12h",
        "winrm_port": "5985",
        "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
        "shutdown_timeout": "15m",
        "guest_os_type": "{{ user `guest_os_type` }}",
        "vm_version": "{{ user `vm_version` }}",
        "CPUs": 4,
        "cpu_cores": 2,
        "CPU_hot_plug": "{{ user `CPU_hot_plug` }}",
        "RAM": 4096,
        "RAM_hot_plug": "{{ user `RAM_hot_plug` }}",
        "network": "{{ user `network` }}",
        "disk_size": 30720,
        "disk_thin_provisioned": "{{ user `disk_thin_provisioned` }}",
        "disk_controller_type": "{{ user `disk_controller_type` }}",
        "network_card": "{{ user `network_card` }}",
        "convert_to_template": "{{ user `convert_to_template` }}",
        "vcenter_server": "{{ user `vcenter_server` }}",
        "insecure_connection": "{{ user `insecure_connection` }}",
        "username": "{{ user `username`}}",
        "password": "{{ user `password` }}",
        "host": "{{ user `host` }}",
        "cluster": "{{ user `cluster` }}",
        "datastore": "{{ user `datastore` }}",
        "folder": "{{ user `folder` }}",
        "floppy_files": [
            "{{ user `answerfile` }}",
            "scripts/Set-WinRM.ps1",
            "scripts/winrm.bat",
            "drivers/",
            "scripts/Install-VMwareToolsVsphere.ps1"
        ]
    }],
    "provisioners": [{
            "type": "powershell",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "scripts": [
                "scripts/Disable-UAC.ps1",
                "scripts/Install-Net35.ps1",
                "scripts/Set-WinRM.ps1"
            ]
        },
        {
            "type": "windows-restart"
        },
        {
            "type": "powershell",
            "scripts": [
                "scripts/Install-Nuget.ps1"
            ]
        },
        {
            "type": "powershell",
            "scripts": [
                "scripts/Remove-UpdateCache.ps1",
                "scripts/Remove-PackerScheduledTasks.ps1",
                "scripts/Invoke-Defrag.ps1",
                "scripts/Reset-EmptySpace.ps1"
            ]
        }
    ]

}
